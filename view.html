<html>

<head>
    <title>
        Blog :=)
    </title>

    <!-- Bootstrap CSS and JS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <!-- Bootstrap CSS and JS Ends -->

    <!-- Misc files -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!-- Misc files Ends -->
    <!-- @TODO: Clean this mess -->
    <!-- Custom BG  Style -->
    <!-- <link href="static/css/bg_parllax_stars.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'> -->
    <!-- <link href="static/worm_bg/worm_bg.css" rel="stylesheet"> -->
    <!-- Custom BG  Style Ends -->

    <!-- version 1.0 style -->
    <!-- @TODO: If large shift to a css file -->
    <link href="static/default/css/deafult.css" rel="stylesheet">
    <!-- version 1.0 style Ends -->
</head>

<body>

    <!-- Magnify Starts -->
    <!--<div id="magnify">
        <h1 onclick="closemagnify()"><i class="fas fa-times"></i></h1>
        <div id="img_here"></div>
    </div> -->
    <!-- Magnify ends -->

    <!-- version 1.0 -->
    <!-- Description: this version will contain the base design like, a solid bg, animated bg will come out in future versions-->
    <div class="row container-fluid">
        <div class="col-sm-9">
            <div class="container-fluid" id="new_blogs">
                <!-- One blog card -->
                <div class="row blog_card">
                    <div class="col">
                        <div class="card text-justify" id="">

                            <div class="card-body blog-card">
                                <h3 class="card-title" id="blog-title"></h3>
                                <p class="card-text" id="blog-author-name"></p>
                                <p class="card-text" id="blog-publish-date"></p>
                                <p class="card-text" id="blog-tags"></p>
                                <h5 class="card-text" id="blog-content"></h5>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="container-fluid blog_card">
                <div class="card text-justify" id="side-panel">

                    <div class="card-body blog-card">
                        <h3 class="card-title">Archives</h3>
                        <br />
                        <h4>View by Date: </h4>
                        <h5 class="card-text"> Jan 2020</h5>
                        <h5 class="card-text"> Feb 2020</h5>
                        <h5 class="card-text"> Mar 2020</h5>
                        <h5 class="card-text"> Jun 2020</h5>
                        <h5 class="card-text"> Jul 2020</h5>
                        <h5 class="card-text"> Apr 2020</h5>

                        <br />

                        <h4>View by Tag(s): </h4>
                        <span class="badge rounded-pill tag tag-color">Tag 1 </span>
                        <span class="badge rounded-pill tag tag-color">Tag 2</span>
                        <span class="badge rounded-pill tag tag-color">Tag 3</span>
                        <span class="badge rounded-pill tag tag-color">Tag 4</span>

                        <br /> <br />

                        <h4>Popular: </h4>
                        <h5 class="card-text"> Blog Title 1</h5>
                        <h5 class="card-text"> Blog Title 2</h5>
                        <h5 class="card-text"> Blog Title 3</h5>
                        <h5 class="card-text"> Blog Title 4</h5>
                        <h5 class="card-text"> Blog Title 5</h5>
                        <h5 class="card-text"> Blog Title 6</h5>

                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- version 1.0 Ends -->

    <!-- Magnify Script -->
    <script src="static/js/magnify.js" type="text/javascript"></script>
    <!-- Magnify Script ends-->

    <!-- Main driver script -->
    <script type="text/javascript">
        const params = new URLSearchParams(window.location.search);
        if (!params) {
            // redirect to home page if no get parameters are passed
            window.location.replace("index.html");
        }
        else {
            if (!params.has("id")) {
                // redirect to home page if "id" parameter is not passed
                window.location.replace("index.html");
            }
            else {
                const blog_id = params.get("id");
                // removed in prod
                // document.getElementById("blog_id").innerHTML = blog_id;

                // fetching metadata about the blog using blog_id
                fetch('static/meta_data/blog_meta_data.json')
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        try {
                            // sending specific json data to the processing function
                            process_meta_data(data[blog_id]);
                        }
                        catch (err) {
                            // try fetching the specific data from the json
                            // if record not found then
                            // redirect to error.html page
                            // error code 1501 - Invalid Blog ID
                            window.location.replace("error.html?err_code=1501");
                            // console.log(err)
                        }
                    })
                    .catch(function (err) {
                        console.log("error" + err);
                    });

                function process_meta_data(blog_meta_data) {

                    // function to fetch and display blog meta data on the page

                    const blog_location = blog_meta_data.blog_location;
                    const blog_title = blog_meta_data.blog_title;
                    const blog_author = blog_meta_data.blog_author;
                    const blog_publish_date = blog_meta_data.blog_publish_date;
                    const blog_tags = blog_meta_data.blog_tags;

                    // console.log(blog_id);
                    // console.log(blog_location);
                    // console.log(blog_title);
                    // console.log(blog_author);
                    // console.log(blog_publish_date);
                    // console.log(blog_tags);

                    document.getElementById("blog-title").innerHTML = blog_title;
                    document.getElementById("blog-author-name").innerHTML = "Author: " + blog_author;
                    document.getElementById("blog-publish-date").innerHTML = "Date Published: " + blog_publish_date;
                    // creating blog tags
                    var tag_container = document.getElementById("blog-tags")
                    tag_container.innerHTML = "Tags: ";
                    for (var i = 0; i < blog_tags.length; i++) {
                        var span = document.createElement("span");
                        span.setAttribute("class", "badge rounded-pill tag tag-color");
                        span.innerHTML = blog_tags[i];
                        tag_container.appendChild(span);
                    }
                    fetch_blog_content(blog_location);
                }

                function fetch_blog_content(blog_location) {
                    // function to fetch blog content
                    fetch(blog_location)
                        .then(function (response) {
                            return response.json();
                        })
                        .then(function (data) {
                            try {
                                create_blog(data.blog_content);
                            }
                            catch (err) {
                                // try fetching the blog content from the blog location
                                // if record not found then
                                // redirect to error.html page
                                // error code 1502 - No Blog content found
                                window.location.replace("error.html?err_code=1502");
                                // console.log(err)

                            }
                        })
                        .catch(function (err) {
                            console.log("error" + err);
                        });
                }

                function create_blog(blog_content) {
                    // function to display blog content on the page
                    // console.log(blog_content);
                    document.getElementById("blog-content").innerHTML = blog_content;
                }
            }
        }
    </script>
    <!-- Main driver script ends -->
</body>

</html>